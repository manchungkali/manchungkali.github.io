---
layout: post
title: "Modbus TCP协议报文解读"
date: 2019-10-6 09:21
comments: true
reward: true
tags: 
	- 工业互联网 
---

折腾了两天，终于搞懂了Modbus TCP协议的报文意思。网上的一些文章其实表达不清晰，我思考了一下午，还是不能明白。终于第二天下午，灵感涌现，接下来请让我娓娓道来。

<!-- more -->

Modbus TCP属于一问一答类型的协议，请求用十六进制的报文格式，应答也是十六进制。机器人对二进制有天然的高识别率，请求的十六进制需要转为二进制格式发送给机器人，机器人收到后也是发送二进制数据返回服务端，服务端需要再转为十六进制，方便我们阅读。
但对于关键点，还是需要转为二进制，0就是false，1就是true，程序才能更好进行下一步。

服务器请求：02 02 10 00 00 1E FC F1

02 站号（一般是从站号）
02 功能码（读取离散量）
10 00 读取M继电器地址起始位置
00 1E 读取M继电器的数量为30个
FC F1 CRC校验码

机器人应答：02 02 04 86 08 40 08 50 6E

02 02 与请求格式对应
04 后面数据的长度为4
86 转为二进制 10000110 从左到右为M7到M0，其中M7、M2、M1是开启状态
08 转为二进制 00001000 从左到右为M15到M8，其中M11是开启状态
40 转为二进制 01000000 从左到右为M23到M16，其中M22是开启状态
08 转为二进制 00001000 从左到右为M32到M24，其中M27是开启状态

由于请求的是30，不是8的倍数，因此机器人系统会自动补全至32

50 6E CRC校验码

剩下的工作需要对照M辅助继电器的说明即可。

总体来说，十六进制与二进制的转换是解读Modbus TCP协议报文的必要条件，对照Modbus地址表也很重要。

